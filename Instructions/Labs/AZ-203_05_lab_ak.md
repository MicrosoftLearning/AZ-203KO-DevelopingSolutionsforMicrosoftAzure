---
lab:
    title: '랩: Azure 에 배치된 모니터링 서비스'
    type: '답변 키'
    module: '모듈 5: Azure 솔루션 모니터링, 문제 해결 및 최적화'
---

# 랩: Azure 에 배치된 모니터링 서비스
# 학생 랩 답변 키

## 마이크로소프트 Azure 사용자 인터페이스

Microsoft 클라우드 도구의 동적 특성을 감안할 때 이 교육 콘텐츠를 개발한 후 Azure 사용자 인터페이스(UI) 변경 사항이 발생할 수 있습니다. 이러한 변경으로 인해 랩 지침 및 단계가 일치하지 않을 수 있습니다.

Microsoft 는 커뮤니티에서 필요한 변경 사항을 가져오는 즉시 이 교육 과정을 업데이트합니다. 그러나 클라우드 업데이트가 자주 발생하기 때문에 이 교육 콘텐츠가 업데이트되기 전에 UI가 변경될 수 있습니다. **이 경우 변경 사항에 적응하고 필요에 따라 랩에서 작업합니다.**

## 지침

### 시작하기 전에

#### 랩 가상 기계에 로그인

  - 다음 자격증명을 사용하여 **Windows 10** 가상 기계에 로그인합니다.
    
      - **사용자 이름**: 관리자
    
      - **비밀번호**: Pa55w.rd

> > **참고**: 랩 가상 기계 로그인 지침은 교수자가 제공합니다.

#### 설치된 응용 프로그램 검토

  - **Windows 10** 바탕 하단에 있는 작업 표시줄을 관찰합니다. 작업 표시줄에는 이 랩에서 사용할 응용 프로그램에 대한 아이콘이 포함되어 있습니다.
    
      - Microsoft Edge
    
      - 파일 탐색기
    
      - Visual Studio Code
    
      - Windows PowerShell

#### 랩 파일 다운로드

1.  작업 표시줄에서 **Windows PowerShell** 아이콘을 선택합니다.

2.  PowerShell 명령 프롬프트에서 현재 작업 디렉토리를 **Allfiles(F):\\** 경로로 변경합니다.

    ```
    cd F:
    ```

3.  명령 프롬프트 내에서 다음 명령을 입력하고 GitHub 에서 호스팅되는 **microsoftlearning/AZ-203-DevelopingSolutionsForAzure** 프로젝트를 복제하기 위해 **랩파일** 디렉토리로 Enter 를 누릅니다.

    ```
    git clone --depth 1 --no-checkout https://github.com/microsoftlearning/AZ-203-DevelopingSolutionsForMicrosoftAzure .
    ```

4.  명령 프롬프트 내에서 다음 명령을 입력하고 **Enter** 를 눌러 **AZ-203.02** 랩을 완료하는 필요한 랩 파일을 체크 아웃합니다.

    ```
    git checkout master -- Allfiles/*
    ```

5.  현재 실행 중인 **Windows PowerShell** 명령 프롬프트 응용 프로그램을 닫습니다.

### 연습 1: Azure 리소스 만들기 및 구성

#### 작업 1: Azure 포털 열기

1.  작업 표시줄에서 **Microsoft Edge** 아이콘을 선택합니다.

2.  열린 브라우저 창에서 [**Azure 포털**](https://portal.azure.com) (portal.azure.com)로 이동합니다.

3.  로그인 페이지에서 Microsoft 계정의 **전자 메일 주소** 를 입력합니다.

4.  **다음** 을 선택합니다.

5.  Microsoft 계정의 **비밀번호** 를 입력합니다.

6.  **로그인** 을 선택합니다.

> **참고**: **Azure 포털** 에 처음 로그인 하는 경우 대화 박스에 포털 둘러보기 제안이 표시됩니다. 둘러보기를 건너뛰고 포털 사용을 시작하려면 **시작하기** 를 선택합니다.

#### 작업 2: 응용 프로그램 인사이트 리소스 만들기

1.  포털의 왼쪽 네비게이션 페인에서 **+ 리소스 만들기** 를 선택합니다.

2.  **새** 블레이드 상단에서 **마켓플레이스 검색** 필드를 찾습니다.

3.  검색 필드에 **인사이트** 를 입력하고 Enter 를 누릅니다.

4.  **모든** 검색 결과 블레이드에서 **응용 프로그램 인사이트** 결과를 선택합니다.

5.  **응용 프로그램 인사이트** 블레이드에서 **만들기** 를 선택합니다.

6.  두 번째 **응용 프로그램 인사이트** 블레이드에서 다음 작업을 수행합니다.
    
    1.  **이름** 필드에 **instrm\[*your name in lowercase*\]** 를 입력합니다.
    
    2.  **응용 프로그램 유형** 목록에서 웹 **ASP.NET응용 프로그램** 을 선택합니다.
    
    3.  **구독** 필드를 기본값으로 설정합니다.
    
    4.  **리소스 그룹** 섹션에서 **새 만든기** 를 선택하고 **MonitoredAssets** 를 입력합니다.
    
    5.  **위치** 목록에서 **미국 동부** 를 선택합니다.
    
    6.  **만들기** 를 선택합니다.

7.  이 랩을 진행하기 전에 만들기 태스크 완료될 때까지 기다립니다.

8.  포털의 왼쪽 네비게이션 페인에서 **리소스 그룹** 을 선택합니다.

9.  **리소스 그룹** 블레이드에서 이전에 랩에서 만든 **MonitoredAssets** 리소스 그룹을 선택합니다.

10. **모니터링된 자산** 블레이드에서 이전에 랩에서 만든 **instrm\*** 응용 프로그램 인사이트 계정을 선택합니다.

11. **응용 프로그램 인사이트** 블레이드에서 블레이드 왼쪽에 **구성** 범주 내에서 **속성** 링크를 선택합니다.

12. **속성** 섹션에서 **계측 키** 필드의 값을 관찰합니다. 이 키는 클라이언트 응용 프로그램에서 응용 프로그램 인사이트에 연결로 사용합니다.

#### 작업 3: API 어플 리소스 만들기

1.  포털의 왼쪽 네비게이션 페인에서 **+ 리소스 만들기** 를 선택합니다.

2.  **새** 블레이드 상단에서 **마켓플레이스 검색** 필드를 찾습니다.

3.  검색 필드에 **API** 를 입력하고 Enter 를 누릅니다.

4.  **모든** 검색 결과 블레이드에서 **API 어플** 결과를 선택합니다.

5.  **API 어플** 블레이드에서 **만들기** 를 선택합니다.

6.  두 번째 **API 어플** 블레이드에서 다음 작업을 수행합니다.
    
    1.  **어플 이름** 필드에 **smpapi\[*your name in lowercase*\]** 를 입력합니다.
    
    2.  **구독** 필드를 기본값으로 설정합니다.
    
    3.  **리소스 그룹** 섹션에서 **기존 사용** 을 선택하고 **모니터링 자산** 을 선택합니다.
    
    4.  **어플 서비스 계획/위치** 필드를 선택합니다.

7.  **어플 서비스 계획** 블레이드에서 **새 만들기** 를 선택합니다.

8.  **새 어플 서비스 계획** 블레이드에서 다음 작업을 수행합니다.
    
    5.  **어플 서비스 계획** 필드에서 **MonitoredPlan** 을 입력합니다.
    
    6.  **위치** 목록에서 **미국 동부** 위치를 선택합니다.
    
    7.  **가격 계층** 필드를 값 **(S1)** 으로 설정합니다.
    
    8.  **확인** 을 선택합니다.

9.  **Api 어플** 블레이드에서 **응용 프로그램 인사이트** 필드를 선택합니다.

10. **응용 프로그램 인사이트** 블레이드에서 다음 작업을 수행합니다.
    
    9.  **응용 프로그램 인사이트 사이트 확장** 섹션에서 **사용 가능** 을 선택합니다.
    
    10. **응용 프로그램 인사이트 리소스에 링크** 섹션에서 **기존 리소스 선택** 을 선택하고 이전에 랩에서 만든 **instrm\*** Application Insights 계정을 선택합니다.
    
    11. **응용 프로그램 도구** 섹션에서 **NET 코어** 탭을 선택하고 **추천** 을 선택합니다.
    
    12. **적용** 을 선택합니다.

11. **Api 어플** 블레이드에서 **만들기** 를 선택합니다.

12. 이 랩을 진행하기 전에 만들기 작업이 완료될 때까지 기다립니다.

13. 포털의 왼쪽 네비게이션 페인에서 **리소스 그룹** 을 선택합니다.

14. **리소스 그룹** 블레이드에서 이전에 랩에서 만든 **MonitoredAssets** 리소스 그룹을 선택합니다.

15. **MonitoredAssets** 블레이드에서 이전에 랩에서 만든 **smpapi\*** API 어플을 선택합니다.

16. **어플 서비스** 블레이드에 블레이드 왼쪽에 설정 범주 내에서 **응용 프로그램 설정** 링크를 선택합니다.

17. **응용 프로그램 설정** 섹션에서 API에 **응용 프로그램 설정** 목록을 찾을 때까지 아래로 스크롤합니다.

18. API와 연결된 비밀을 보려면 **값 표시** 를 선택합니다.

19. **APPINSIGHTS\_ INSTRUMENTATIONKEY** 키에 해당하는 값을 관찰합니다. 이 값은 API App 리소스를 빌드할 때 자동으로 설정되었습니다.

20. **어플 서비스** 블레이드에서 **설정** 범주 내의 블레이드 왼쪽에 **속성** 링크를 선택합니다.

21. **속성** 섹션에서 **URL** 필드의 값을 기록합니다. 이 값을 나중에 랩에서 사용하여 API에 요청을 합니다.

#### 작업 4: API 어플 자동 스케일 조정 옵션 구성

1.  **어플 서비스** 블레이드에서 블레이드 왼쪽에 있는 **설정** 범주에서 **스케일 앗** 링크 를 선택합니다.

2.  **스케일 앗** 섹션에서 다음 작업을 수행합니다.
    
    1.  **사용 가능 앗 스케일** 을 선택합니다.
    
    2.  **앗 프케일 설정 이름** 필드에 **ComputeScaler** 를 입력합니다.
    
    3.  **리소스 그룹** 목록에서 **모니터링 자산** 을 선택합니다.
    
    4.  **스케일 모드** 섹션에서 **메트릭에 따라서 스케일** 을 선택합니다.
    
    5.  **인스턴스 제한** 섹션 내의 ** 최소**필드에 **2** 를 입력합니다.
    
    6.  **인스턴스 제한** 섹션 내의 **최대** 필드에 **8** 을 입력합니다.
    
    7.  **인스턴스 제한** 섹션 내의 **기본** 필드에 **3** 을 입력합니다.
    
    8.  **규칙 추가**를 선택합니다. 표시되는 **스케일 규칙** 창에서 모든 필드를 기본값으로 설정하고 **추가** 를 선택합니다.
    
    9.  섹션 위쪽에 **정장** 을 선택합니다.

3.  이 랩을 진행하기 전에 저장 작업이 완료될 때까지 기다립니다.

#### 검토

이 연습에서는 랩의 나머지 부분에 사용할 리소스를 만들었습니다.

### 연습 2: ASP.NET 코어 웹 API 응용 프로그램 구축 및 배치

#### 작업 1: .NET 코어 웹 API 프로젝트 빌드

1.  작업 표시줄에서 **Visual Studio Code** 아이콘을 선택합니다.

2.  **파일** 메뉴에서 **폴더 열기** 를 선택합니다.

3.  열리는 파일 탐색기 페인에서 **Allfiles (F):\\Labfiles\\05\\Starter\\Api** 로 이동하고 **폴더선택** 을 선택합니다.

4.  Visual Studio Code 창에서 컨텍스트 메뉴에 액세스하거나 **탐색기** 페인을 마우스 오른쪽 단추로 클릭하고 **터미널에서 열기** 를 선택합니다.

5.  오픈 명령 프롬프트에서 다음 명령을 입력하고 Enter 를 눌러 현재 디렉터리에서 **SimpleApi** 라는 새 .NET Core 웹 API 응용 프로그램을 만듭니다.

dotnet new webapi --output . --name SimpleApi

6.  명령 프롬프트에서 다음 명령을 입력하고 Enter 를 눌러NuGet에서 현재 프로젝트에 **2.6.1** 버전의 **Microsoft.ApplicationInsights.AspNetCore** 패키지를 추가합니다.

dotnet add package Microsoft.ApplicationInsights.AspNetCore --version 2.6.1

7.  명령 프롬프트에서 다음 명령을 입력하고 Enter 를 눌러 .NET Core 웹 응용 프로그램을 빌드합니다.

dotnet build

#### 작업 2: HTTPS 를 사용하지 않도록 설정하고 응용 프로그램 인사이트를 사용하도록 응용 프로그램 코드를 업데이트합니다.

1.  **Visual Studio Code** 창의 왼쪽에 **탐색기** 페인에서 **Program.cs** 파일을 두 번 클릭하여 편집기에서 파일을 엽니다.

2.  편집기에서 **프로그램** 클래스에서 **20** 줄에서 다음 코드 블록을 찾습니다.

public static IWebHostBuilder CreateWebHostBuilder(string\[\] args) =\>

WebHost.CreateDefaultBuilder(args)

.UseStartup\<Startup\>();

3.  해당 코드 블록을 프로젝트에 대한 **Application Insights** 원격 분석을 가능하게 하는 다음 코드블록으로 바꿉니다.

public static IWebHostBuilder CreateWebHostBuilder(string\[\] args) =\>

WebHost.CreateDefaultBuilder(args)

.UseStartup\<Startup\>()

.UseApplicationInsights();

4.  **Program.cs** 파일을 **저장** 합니다.

5.  **Visual Studio Code** 창의 왼쪽에 **탐색기** 페인에서 **Startup.cs** 파일을 두 번 클릭하여 편집기에서 파일을 엽니다.

6.  편집기에서 **프로그램** 클래스에서 **44** 줄에서 다음 코드 줄을 찾아 삭제합니다.

app.UseHttpsRedirection();

> > **참고**: 이 코드 줄은 API 어플이 HTTPS를 사용하도록 강제합니다. 이 랩에서는 이 작업을 사용할 필요가 없습니다.

7.  **Startup.cs** 파일을 **저장합니다**.

<!-- end list -->

8.  화면 아래쪽의 거북이를 보세요. 명령 프롬프트에서 다음 명령을 입력하고 Enter 를 눌러 .NET Core 웹 응용 프로그램을 빌드합니다.

dotnet build

#### 작업 3: API 응용 프로그램을 로컬로 테스트

1.  화면 아래쪽의 거북이를 보세요. 명령 프롬프트에서 다음 명령을 입력하고 Enter 를 눌러 .NET Core 웹 응용 프로그램을 실행합니다.

dotnet run

2.  작업 표시줄에서 **Microsoft Edge** 아이콘을 선택합니다.

3.  열린 브라우저 창에서 포트 **5000** 의 **localhost** 에서 호스팅되는 테스트 응용 프로그램의 **/api/value** 상대 경로로 이동합니다.
    
    **참고**: 전체 URL 이 http://localhost:5000/api/values.

4.  동일한 브라우저 창에서 포트 **5000** 의 **localhost** 에서 호스팅되는 테스트 응용 프로그램의 **/api/values/7** 상대 경로로 이동합니다.
    
    **참고**: 전체 URL 이 http://localhost:5000/api/values/7

5.  http://localhost:5000/api/values/7 주소를 표시하는 브라우저 창을 닫습니다.

6.  현재 실행 중인 **Visual Studio 코드** 응용 프로그램을 닫습니다.

#### 작업 4: 응용 프로그램 인사이트 메트릭 보기

1.  **Azure 포털** 을 표시하는 현재 열려있는 브라우저 창으로 돌아갑니다.

2.  포털의 왼쪽에서 **리소스 그룹** 을 선택합니다.

3.  **리소스 그룹** 블레이드에서 이전에 랩에서 만든 **MonitoredAssets** 리소스 그룹을 찾아서 선택합니다.

4.  **모니터링된 자산** 블레이드에서 이전에 랩에서 만든 **instrm\*** 응용 프로그램 인사이트 계정을 선택합니다.

5.  **응용 프로그램 인사이트** 블레이드에서 블레이드 중앙에 있는 타일에서 표시된 메트릭을 관찰합니다. 특히 발생한 **서버** **요청** 수와 **평균 서버 응답 시간** 을 확인합니다.

#### 작업 5: API 어플에 응용 프로그램 배치

1.  작업 표시줄에서 **Visual Studio Code** 아이콘을 선택합니다.

2.  **파일** 메뉴에서 **폴더 열기** 를 선택합니다.

3.  열리는 파일 탐색기 페인에서 **Allfiles (F):\\Labfiles\\Starter\\Api** 로 이동하여 **폴더 선택** 을 선택합니다.

4.  Visual Studio Code 창에서 컨텍스트 메뉴에 액세스하거나 **탐색기** 페인을 마우스 오른쪽 단추로 클릭한 다음 **터미널에서 열기** 를 선택합니다.

5.  열린 명령 프롬프트에서 다음 명령을 입력하고 Enter 를 눌러 Azure CLI에 로그인합니다.

az login

6.  표시되는 브라우저 창에서 다음 작업을 수행합니다.
    
    1.  Microsoft 계정의 **전자 메일 주소** 를 입력합니다.
    
    2.  **다음** 을 선택합니다.
    
    3.  Microsoft 계정의 **비밀번호** 를 입력합니다.
    
    4.  **로그인** 을 선택합니다.

7.  현재 열려 있는 **명령 프롬프트** 응용 프로그램으로 돌아갑니다. 로그인 프로세스가 완료될 때까지 기다립니다.

8.  명령 프롬프트에서 다음 명령을 입력하고 Enter 를 눌러 **MonitoredAssets** 리소스 그룹의 모든 **어플** 을 나열합니다.

az webapp list --resource-group MonitoredAssets

9.  다음 명령을 입력하고 Enter 를 눌러 접두사 **smpapi\*** 가 있는 **어플** 을 찾습니다.

az webapp list --resource-group MonitoredAssets --query "\[?starts\_with(name, 'smpapi')\]"

10. 다음 명령을 입력하고 Enter 를 눌러 접두사 **smpapi\*** 가 있는 싱글 어플의 이름만 인쇄합니다.

az webapp list --resource-group MonitoredAssets --query "\[?starts\_with(name, 'smpapi')\].{Name:name}" --output tsv

11. 다음 명령을 입력하고 Enter 를 눌러 현재 디렉터리를 배치 파일을 포함된 **Allfiles (F):\\Labfiles\\05\\Starter** 디렉토리로 변경합니다,

cd F:\\Labfiles\\05\\Starter\\

12. 다음 명령을 입력하고 Enter 를 눌러 이전에 랩에서 만든 **API 어플** 에 **api.zip** 파일을 배치합니다.

az webapp deployment source config-zip --resource-group MonitoredAssets --src api.zip --name \<name-of-your-api-app\>

> > **참고**: **\<Name-of-your-api-app\>** 플레이스 홀더를 이전에 랩에서 만든 API 어플의 이름으로 바꿉니다. 최근에 이전 단계에서 이 어플의 이름을 쿼리했습니다.

13. 이 랩을 진행하기 전에 배치가 완료될 때까지 기다립니다.

14. 현재 실행 중인 **Visual Studio Code** 응용 프로그램을 닫습니다.

15. 포털의 왼쪽 네비게이션 페인에서 **리소스 그룹** 을 선택합니다.

16. **리소스 그룹** 블레이드에서 이전에 랩에서 만든 **MonitoredAssets** 리소스 그룹을 선택합니다.

17. **MonitoredAssets** 블레이드에서 이전에 랩에서 만든 **smpapi\*** API 어플을 선택합니다.

18. **어플 서비스** 블레이드에 상단에서 **부라우저** 를 선택합니다.

19. 새 브라우저 창 또는 탭이 열리고 **404(찾을 수 없는)** 오류가 반환됩니다. 브라우저 주소 표시줄에서 현재 URL의 끝에 접미사 **/api/values** 을 더하여 URL을 업데이트하고 Enter 를 누릅니다.

> > **참고**: 예를 들어 URL 이 http://smpapistudent.azurewebsites.net 경우새 URL 이 http://smpapistudent.azurewebsites.net/api/values 입니다.

20. API 를 사용하여 반환되는 JSON 배열을 관찰합니다.

#### 검토

이 연습에서는 ASP.NET Core 를 사용하여 API 를 만들고 응용 프로그램 메트릭을 응용 프로그램 인사이트로 스트리밍하도록 구성했습니다. 다음 응용 프로그램 인사이트 대시보드를 사용하여 API 어플 및 어플에서 실행 중인 API에 대한 성능 세부 정보를 볼 수 있습니다.

### 연습 3: .NET 코어를 사용하여 클라이언트 응용 프로그램 빌드

#### 작업 1: .NET 코어 콘솔 프로젝트 빌드

1.  작업 표시줄에서 **Visual Studio Code** 아이콘을 선택합니다.

2.  **파일** 메뉴에서 **폴더 열기** 를 선택합니다.

3.  열리는 파일 탐색기 페인에서 **Allfiles (F):\\Labfiles\\Starter\\Console** 이동하여 **폴더 선택** 을 선택합니다.

4.  Visual Studio Code 창에서 컨텍스트 메뉴에 액세스하거나 **탐색기** 페인을 마우스 오른쪽 단추로 클릭한 다음 **터미널에서 열기** 를 선택합니다.

5.  오픈 명령 프롬프트에서 다음 명령을 입력하고 Enter 를 눌러 현재 디렉터리에서 **SimpleConsole** 이라는 새 .NET Core 콘솔 응용 프로그램을 만듭니다.

dotnet new console --output . --name SimpleConsole

6.  명령 프롬프트에서 다음 명령을 입력하고 Enter 를 눌러 NuGet 에서 현재 프로젝트에 **2.2.29** 버전의 **Microsoft.Net.Http** 패키지를 추가합니다.

dotnet add package Microsoft.Net.Http --version 2.2.29

7.  명령 프롬프트에서 다음 명령을 입력하고 Enter 를 눌러 NuGet 에서 현재 프로젝트에 **7.0.2** 버전의 **Polly** 패키지를 추가합니다.

dotnet add package Polly --version 7.0.2

8.  명령 프롬프트에서 다음 명령을 입력하고 Enter 를 눌러 .NET Core 웹 응용 프로그램을 빌드합니다.

dotnet build

#### 작업 2: HTTP 클라이언트 코드 추가

1.  **Visual Studio Code** 창의 왼쪽에 **탐색기** 페인에서 **Program.cs** 파일을 두 번 클릭하여 편집기에서 파일을 엽니다.

2.  편집기에서 **System.Net.Http** 네임스페이스에 대한 블록을 **사용** 하여 다음을 추가합니다.

using System.Net.Http;

3.  편집기에서 **System.Threading.Tasks** 네임스페이스에 대한 블록을 **사용** 하여 다음을 추가합니다.

using System.Threading.Tasks;

4.  **SimpleConsole** 네임스페이스에서 **7** 줄에서 다음 클래스를 찾습니다.

class Program

{

static void Main(string\[\] args)

{

Console.WriteLine("Hello World\!");

}

}

5.  **프로그램** 클래스의 코드를 다음 코드로 바꿉니다.

class Program

{

private const string \_api = "";

private static HttpClient \_client = new HttpClient(){ BaseAddress = new Uri(\_api) };

static void Main(string\[\] args)

{

Run().Wait();

}

static async Task Run()

{

}

}

6.  **9** 줄에서 **\_api** 상수를 찾습니다.

private const string \_api = "";

7.  이전에 랩에서 기록한 API어플의 **URL** 에 변수 값을 설정하여 **\_api** 상수를 업데이트합니다.

> > **참고**: 예를 들어 URL 이 http://smpapistudent.azurewebsites.net 경우 새 코드 줄은 private const string \_api = “http://smpapistudent.azurewebsites.net” 입니다.

8.  **실행** 메서드 내에서 다음 코드 줄을 추가하여 **httpClient.GetStringAsync** 메서드를 비동기적으로 호출하여 **/api/값/** 의 상대 경로에 대한 문자열로 전달합니다.

string response = await \_client.GetStringAsync("/api/values/");

9.  **Run** 메서드 내에서 추가 코드 줄을 추가하여 **GET** 요청에서 콘솔에 대한 응답을 작성합니다.

Console.WriteLine(response);

10. 이제 **Program.cs** 파일에 다음 코드가 있어야 합니다.

using System;

using System.Net.Http;

using System.Threading.Tasks;

namespace SimpleConsole

{

class Program

{

private const string \_api = "http://\<your-api-name\>.azurewebsites.net ";

private static HttpClient \_client = new HttpClient(){ BaseAddress = new Uri(\_api) };

static void Main(string\[\] args)

{

Run().Wait();

}

static async Task Run()

{

string response = await \_client.GetStringAsync("/api/values/");

Console.WriteLine(response);

}

}

}

11. **Program.cs** 파일을 **저장** 합니다.

#### 작업 3: 콘솔 응용 프로그램 로컬 테스트

1.  화면 하단에서 명령 프롬프트에서 다음 명령을 입력하고 Enter 를 눌러 .NET Core 웹 응용 프로그램을 실행합니다.

dotnet run

2.  응용 프로그램이 Azure에서 API 어플을 성공적으로 호출하고 이전에 랩에서 관찰한 것과 동일한 JSON 배열을 반환하는지 관찰합니다. 결과는 다음 JSON 콘텐츠와 유사하게 표시되어야 합니다.

\["value1","value2"\]

3.  **Azure 포털** 을 표시하는 현재 열려있는 브라우저 창으로 돌아갑니다.

4.  포털의 왼쪽에서 **리소스 그룹** 을 선택합니다.

5.  **리소스 그룹** 블레이드에서 이전에 랩에서 만든 **MonitoredAssets** 리소스 그룹을 찾아서 선택합니다.

6.  **MonitoredAssets** 블레이드에서 이전에 랩에서 만든 **smpapi\*** API 어플을 선택합니다.

7.  **어플 서비스** 블레이드에 블레이드 상단에서 **중지** 를 선택하여 API 어플 실행을 중지합니다.

8.  **웹어플 중지** 확인 대화 박스에서 **예** 를 선택합니다.

9.  작업 표시줄에서 **Visual Studio Code** 아이콘을 선택합니다.

10. **파일** 메뉴에서 **폴더 열기** 를 선택합니다.

11. 열리는 파일 탐색기 페인에서 **Allfiles (F):\\Labfiles\\Starter\\Console** 로 이동하여 **폴더 선택** 을 선택합니다.

12. Visual Studio Code 창에서 컨텍스트 메뉴에 액세스하거나 **탐색기** 페인을 마우스 오른쪽 단추로 클릭한 다음 **터미널에서 열기** 를 선택합니다.

13. 열린 명령 프롬프트에서 다음 명령을 입력하고 Enter 를 눌러 .NET Core 웹 응용 프로그램을 실행합니다.

dotnet run

14. 응용 프로그램 실행이 실패하고 다음 예외 메시지와 유사한 **HttpRequestException** 메시지가 표시되는지 관찰하십시오.

System.Net.Http.HttpRequestException: 응답 상태 코드는

코드가 잘 작성됐네요. 403(사이트 사용 안 함).

at System.Net.Http.HttpResponseMessage.EnsureSuccessStatusCode()

at System.Net.Http.HttpClient.GetStringAsyncCore(Task\`1 getTask)

at SimpleConsole.Program.Run() in F:\\Labfiles\\Starter\\Console\\Program.cs:line 20

> > **참고**: 이 예외는 API 어플을 더 이상 사용할 수 없기 때문에 발생합니다.

#### 작업 4: 폴리를 사용하여 재시도 논리 추가

1.  **Visual Studio Code** 창의 왼쪽에 **탐색기** 페인에서 **PollyHandler.cs** 파일을 두 번 클릭하여 편집기에서 파일을 엽니다.

2.  **폴리핸들러** 클래스 내에서 **13-24** 줄을 관찰합니다. 이러한 코드 줄은 **NET Foundation** 의 **Polly** 라이브러리를 사용하여 5분마다 실패한 HTTP 요청을 다시 시도하는 재시도 정책을 만듭니다.

3.  **Visual Studio Code** 창의 왼쪽에 **탐색기** 페인에서 **Program.cs** 파일을 두 번 클릭하여 편집기에서 파일을 엽니다.

4.  **10** 줄에서 **\_client** 상수를 찾습니다.

private static HttpClient \_client = new HttpClient(){ BaseAddress = new Uri(\_api) };

5.  **PollyHandler** 클래스의 새 인스턴스를 사용 하도록 **HttpClient** 생성기를 업데이트하여 **\_client** 상수를 업데이트 합니다.

private static HttpClient \_client = new HttpClient(new PollyHandler()){ BaseAddress = new Uri(\_api) };

6.  **Program.cs** 파일을 **저장** 합니다.

#### 작업 5: 재시도 논리 검증

1.  화면 하단에서 명령 프롬프트에서 다음 명령을 입력하고 Enter 를 눌러 .NET Core 웹 응용 프로그램을 실행합니다.

dotnet run

2.  HTTP 요청 실행이 계속 실패하고 5초마다 다시 시도되는지 관찰합니다. 응용 프로그램이 실패하는 동안 콘솔에서 다음 메시지가 표시됩니다.

실패한 시도

3.  콘솔 응용 프로그램을 실행 상태로 둡니다. 성공할 때까지 API 어플에 무한히 액세스하려고 시도합니다.

4.  **Azure 포털** 을 표시하는 현재 열려있는 브라우저 창으로 돌아갑니다.

5.  포털의 왼쪽에서 **리소스 그룹** 을 선택합니다.

6.  **리소스 그룹** 블레이드에서 이전에 랩에서 만든 **MonitoredAssets** 리소스 그룹을 찾아서 선택합니다.

7.  **MonitoredAssets** 블레이드에서 이전에 랩에서 만든 **smpapi\*** API 어플을 선택합니다.

8.  **어플 서비스** 블레이드상단에서 **시작** 을 선택하여API 어플을 다시 시작합니다.

9.  **웹어플 중지** 확인 대화 박스에서 **예** 를 선택합니다.

10. 현재 실행 중인 **Visual Studio Code** 응용 프로그램으로 돌아갑니다.

11. 응용 프로그램이 마지막으로 Azure에서 API 어플을 성공적으로 호출하고 이전에 랩에서 관찰한 것과 동일한 JSON 배열을 반환하는지 관찰합니다. 결과는 다음과 같은 JSON 콘텐츠와 유사해야 합니다.

\["value1","value2"\]

12. 현재 실행 중인 **Visual Studio Code** 응용 프로그램을 닫습니다.

#### 검토

이 연습에서는 조건부 재시도 로직을 사용하여 API에 액세스하는 콘솔 응용 프로그램을 만들었습니다. API 어플을 사용할 수 있는지 여부에 관계없이 응용 프로그램이 계속 작동했습니다.

### 연습 4: 로드 테스트 API 어플

#### 작업 1: API 어플에서 성능 테스트 실행

1.  **Azure 포털** 을 표시하는 현재 열려있는 브라우저 창으로 돌아갑니다.

2.  포털의 왼쪽에서 **리소스 그룹** 을 선택합니다.

3.  **리소스 그룹** 블레이드에서 이전에 랩에서 만든 **MonitoredAssets** 리소스 그룹을 찾아서 선택합니다.

4.  **MonitoredAssets** 블레이드에서 이전에 랩에서 만든 **smpapi\*** API 어플을 선택합니다.

<!-- end list -->

4.  **어플 서비스** 블레이드에서 **개발 도구** 범주 내의 블레이드 왼쪽에 **성능 테스트** 를 선택합니다.

<!-- end list -->

5.  **성능 테스트** 섹션에서 섹션 상단에서 **새** 를 선택합니다.

6.  **새 성능 테스트** 블레이드에서 다음 작업을 수행합니다.
    
    1.  **이름** 필드에 **부하 테스트** 를 입력합니다.
    
    2.  **부하 생성 원본** 목록에서 **미국 동부(웹 앱 위치)** 를 선택합니다.
    
    3.  **사용자 부하** 필드에 **1000** 을 입력합니다.
    
    4.  **지속 시간** 필드에 **10** 을 입력합니다.
    
    5.  **배치 테스트 사용** 을 선택합니다.

7.  **배치 테스트 사용** 블레이드에서 다음 작업을 수행합니다.
    
    6.  **테스트 유형** 목록에서 **수동 테스트** 를 선택합니다.
    
    7.  **URL** 필드에서 현재 URL 끝에 접미사 **/api/values** 을 추가하여 URL 을 업데이트합니다.

> > **참고**: 예를 들어 URL이 http://smpapistudent.azurewebsites.net 경우 새 URL이 http://smpapistudent.azurewebsites.net/api/values입니다.

8.  **완료** 를 선택합니다.

<!-- end list -->

8.  **새 성능 테스트** 블레이드에서 **테스트 실행** 을 선택합니다.

9.  **성능 테스트** 섹션으로 돌아가서 **최근 실행** 목록에서 **부하 테스트** 를 선택합니다.

10. **부하 테스트** 블레이드에서 랩을 진행하기 전에 테스트가 시작될 때까지 기다립니다.

> > **참고**: 대부분의 부하 테스트는 리소스를 수집하고 시작하는 데 약 10~15 분이 걸립니다. 부하 테스트가 시작되면 자동으로 새로 고쳐지므로 이 블레이드에서 기다릴 수 있습니다.

11. 랩을 진행하기 전에 부하 테스트가 완료될 때까지 기다립니다. API 어플사용량이 증가함에 따라 라이브 차트 업데이트가 지켜지는 지 관찰합니다.

> > **참고**: 부하 테스트는 이전에 랩의 단계에서 지정한 10 분 정도 걸립니다.

#### 작업 2: 성능 테스트 후 Azure 모니터 메트릭 사용

1.  Azure 포털의 왼쪽 네비게이션 페인에서 **모든 서비스** 를 선택합니다.

2.  **모든 서비스** 블레이드에서 **모니터** 를 선택합니다.

3.  **모니터** 블레이드에서 블레이드의 왼쪽에 **메트릭** 을 선택합니다.

4.  **메트릭** 섹션에서 다음 작업을 수행합니다.
    
    1.  **리소스** 섹션에서 ** 리소스 선택** 을 선택합니다.
    
    2.  **리소스 그룹** 목록에서 나타나는 **리소스 선택** 창에서 **모니터링된 자산** 을 선택합니다. **리소스**목록에서 **instrm\*** 응용 프로그램 인사이트 계정 옵션을 선택합니다. 마지막으로 **적용** 을 선택하여 창을 닫고 선택 사항을 확인합니다.
    
    3.  **메트릭 네임스페이스** 목록에서 **표준** 범주에서 **표준 메트릭** 을 선택합니다.
    
    4.  **메트릭** 목록에서 **성능 카운터** 범주에서 프로세스 **CPU** 를 선택합니다.
    
    5.  **취합** 목록에서 **평균** 을 선택합니다.
    
    6.  섹션 상단에서 **마지막 24시간(자동)** 을 선택합니다. 표시되는 창에서 **시간 범위 범주** 에서 마지막 **30 분** 을 선택하고 **적용** 을 선택하여 저장합니다.
    
    7.  섹션 상단에서 **라인 차트** 를 선택합니다. 표시되는 메뉴에서 **영역 차트** 를 선택합니다.

5.  새로 만든 차트를 관찰합니다.

6.  메시지 위쪽에서 **메트릭 추가** 를 클릭합니다.

7.  **메트릭** 섹션에서 목록의 새 메트릭 항목을 통해 다음 작업을 수행합니다.
    
    8.  **메트릭 네임스페이스** 목록에서 **표준 범주** 에서 **로그 기반 메트릭** 을 선택합니다.
    
    9.  **메트릭** 목록에서 **서버** 범주에서 **서버 응답** 시간을 선택합니다.
    
    10. **취합** 목록에서 **평균** 을 선택합니다.

8.  업데이트된 차트를 관찰합니다. 차트에 표시된 정보를 관찰합니다. 서버 응답 시간이 응용 프로그램의 로드가 증가함에 따라 CPU 시간과 어떻게 상관 관계가 있는지 관찰할 수 있습니다.

#### 복검토

이 연습에서는 Azure 에서 사용할 수 있는 도구를 사용하여 API 앱의 성능(부하) 테스트를 수행했습니다. 부하 테스트를 수행한 후 Azure Monitor 인터페이스의 메트릭을 사용하여 API 어플의 동작을 측정할 수 있었습니다.

### 연습 5: 구독 정리 

#### 작업 1: 오픈 클라우드 쉘

1.  Azure 포털 상단에서 **클라우드 셸** 아이콘을 선택하여새 셸 인스턴스를 엽니다.

2.  **Cloud Shell** 명령 프롬프트의 포털 하단에 다음 명령을 입력하고 Enter 를 눌러 구독의 모든 리소스 그룹을 나열합니다.

az group list

3.  다음 명령을 입력하고 Enter 를 눌러 리소스 그룹을 삭제할 수 있는 명령 목록을 봅니다.

az group delete --help

#### 작업 2: 리소스 그룹 삭제

1.  다음 명령을 입력하고 Enter 를 눌러 **MonitoredAssets** 리소스 그룹을 삭제합니다.

az group delete --name MonitoredAssets --no-wait --yes

2.  포털 하단의 **클라우드 셸 페인** 을 닫습니다.

#### 작업 3: 활성 응용 프로그램 닫기

1.  현재 실행 중인 **Microsoft Edge** 응용 프로그램을 닫습니다.

2.  현재 실행 중인 **Visual Studio Code** 응용 프로그램을 닫습니다.

#### 검토

이 연습에서는 이 랩에 사용된 **리소스 그룹** 을 제거하여 구독을 정리했습니다.
